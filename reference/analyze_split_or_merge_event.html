<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Analyze split or merge event — analyze_split_or_merge_event • cocomo</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Analyze split or merge event — analyze_split_or_merge_event"><meta name="description" content="
Analyze (and, if make_plot=T make a visualization of) a fission-fusion event."><meta property="og:description" content="
Analyze (and, if make_plot=T make a visualization of) a fission-fusion event."></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">cocomo</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Analyze split or merge event</h1>

      <div class="d-none name"><code>analyze_split_or_merge_event.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p><a href="https://lifecycle.r-lib.org/articles/stages.html#experimental" class="external-link"><img src="figures/lifecycle-experimental.svg" alt="[Experimental]"></a></p>
<p>Analyze (and, if <code>make_plot=T</code> make a visualization of) a fission-fusion event.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">analyze_split_or_merge_event</span><span class="op">(</span></span>
<span>  <span class="va">events</span>,</span>
<span>  <span class="va">i</span>,</span>
<span>  <span class="va">xs</span>,</span>
<span>  <span class="va">ys</span>,</span>
<span>  <span class="va">timestamps</span>,</span>
<span>  max_time <span class="op">=</span> <span class="fl">600</span>,</span>
<span>  thresh_h <span class="op">=</span> <span class="fl">50</span>,</span>
<span>  thresh_l <span class="op">=</span> <span class="fl">15</span>,</span>
<span>  depart_or_arrive_radius <span class="op">=</span> <span class="fl">15</span>,</span>
<span>  time_window <span class="op">=</span> <span class="fl">300</span>,</span>
<span>  seconds_per_time_step <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  breaks <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  break_by_day <span class="op">=</span> <span class="cn">F</span>,</span>
<span>  make_plot <span class="op">=</span> <span class="cn">T</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-events">events<a class="anchor" aria-label="anchor" href="#arg-events"></a></dt>
<dd><p>a data frame of fission-fusion events, output from <code>identify_splits_and_merges</code></p></dd>


<dt id="arg-i">i<a class="anchor" aria-label="anchor" href="#arg-i"></a></dt>
<dd><p>index of the row to use in the events table</p></dd>


<dt id="arg-xs">xs<a class="anchor" aria-label="anchor" href="#arg-xs"></a></dt>
<dd><p><code>n_inds x n_times</code> matrix of x coordinates</p></dd>


<dt id="arg-ys">ys<a class="anchor" aria-label="anchor" href="#arg-ys"></a></dt>
<dd><p><code>n_inds x n_times</code> matrix of y coordinates</p></dd>


<dt id="arg-timestamps">timestamps<a class="anchor" aria-label="anchor" href="#arg-timestamps"></a></dt>
<dd><p>vector of timestamps of length <code>n_times</code> in datetime format</p></dd>


<dt id="arg-max-time">max_time<a class="anchor" aria-label="anchor" href="#arg-max-time"></a></dt>
<dd><p>maximum time steps forward and back to look for the start and end of the event (units are timesteps, not seconds)</p></dd>


<dt id="arg-thresh-h">thresh_h<a class="anchor" aria-label="anchor" href="#arg-thresh-h"></a></dt>
<dd><p>upper threshold for determining when subgroups are "apart" (default 50)</p></dd>


<dt id="arg-thresh-l">thresh_l<a class="anchor" aria-label="anchor" href="#arg-thresh-l"></a></dt>
<dd><p>lower threshold for determining when subgroups are "together" (default 15)</p></dd>


<dt id="arg-depart-or-arrive-radius">depart_or_arrive_radius<a class="anchor" aria-label="anchor" href="#arg-depart-or-arrive-radius"></a></dt>
<dd><p>threshold for determining what an individual has departed (for fissions) or arrived (for fusions) at the group, used in computing departure/arrival times and headings</p></dd>


<dt id="arg-time-window">time_window<a class="anchor" aria-label="anchor" href="#arg-time-window"></a></dt>
<dd><p>time steps to move backward or forward in time to identify the before and after times (units are timesteps, not seconds)</p></dd>


<dt id="arg-seconds-per-time-step">seconds_per_time_step<a class="anchor" aria-label="anchor" href="#arg-seconds-per-time-step"></a></dt>
<dd><p>seconds per time step (default 1)</p></dd>


<dt id="arg-breaks">breaks<a class="anchor" aria-label="anchor" href="#arg-breaks"></a></dt>
<dd><p>indexes to breaks in the data (default NULL treats data as a contiguous sequence). If specified, overrides <code>break_by_day</code></p></dd>


<dt id="arg-break-by-day">break_by_day<a class="anchor" aria-label="anchor" href="#arg-break-by-day"></a></dt>
<dd><p>whether to break up data by date (T or F)</p></dd>


<dt id="arg-make-plot">make_plot<a class="anchor" aria-label="anchor" href="#arg-make-plot"></a></dt>
<dd><p>whether to plot the event (if <code>T</code>) or not (if <code>F</code>)</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>Returns a list (<code>out</code>) of information extracted about the event, as well as a plot (if <code>make_plot = T</code>).</p>
<p>The list contains:</p>
<p><code>start_time</code>: start time index</p>
<p><code>end_time</code>: end time index</p>
<p><code>before_time</code>: before time index</p>
<p><code>after_time</code>: after time index</p>
<p><code>disps</code>: matrix of displacements of the different subgroups (rows) during the different
time intervals (columns). Rows and columns are named for easy access.</p>
<p><code>speeds</code>: same format as <code>disps</code> matrix, but with speeds, in m / s</p>
<p><code>split_angle</code>: split angle in degrees, description above</p>
<p><code>turn_angle_A</code>: turning angle for subgroup A in degrees, description above</p>
<p><code>turn_angle_B</code>: turn angle for subgroup B in degrees, description above</p>
<p><code>depart_or_arrive_times</code>: vector of departure (fission) or arrival (fusion) times for each individual in big_group_idxs (from original events table)</p>
<p><code>depart_or_arrive_headings</code>: vector of departure (fission) or arrival (fusion) headings for each individual in big_group_idxs (from original events table)</p>
<p><code>depart_or_arrive_time_diff</code>: difference between the mean departure (fission) or arrival (fusion) time across the two subgroups</p>
<p><code>depart_or_arrive_heading_diff</code>: difference between the mean vector departure (fission) or arrival (fusion) heading across the two subgroups</p>
<p>The plot shows (top) dyadic distance over time with lines showing the identified times
and (bottom) a visualization of trajectories of the two subgroups.</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>This function takes in information about a fission or fusion event as well as
tracking data to identify relevant time points in the fission or fusion event and compute relevant metrics about the event.
First, the <code>start_time</code> and <code>end_time</code> of the event are determined based on
a double threshold method, then a <code>before_time</code> and <code>after_time</code> are identified.
This identifies 3 phases of the event: before (<code>before_time:start_time</code>), during
(<code>start_time:end_time</code>) and after (<code>end_time:after_time</code>).
Finally the displacements and speeds of the subgroups during these phases and various
relevant angles are calculated. More details are given below. Note that this function can only
consider events involving 2 subgroups.</p>
    </div>
    <div class="section level2">
    <h2 id="additional-details">Additional details<a class="anchor" aria-label="anchor" href="#additional-details"></a></h2>



<p><em>How are the start and end time identified?</em></p>
<p>As a start, we look at a window of time around an identified event (can be
manually or automatically identified). The size of the window is determined by
the parameter '<code>max_time</code>', and we go from <code>(tidx - max_time):(tidx + max_time)</code>
where <code>tidx</code> is the identified event time index.</p>
<p>Within the window, we compute the distance between the centroids of the two
subgroups that are splitting or merging at each time point.
We then use a double threshold method to determine the start and end point of
the fission or fusion event within that time window. To do so, we first
categorize all time points as being above the higher threshold <code>thresh_h</code> (2),
between the two thresholds (1), or below the lower threshold <code>thresh_l</code> (0). We
then identify contiguous periods of time where the dyadic distance went from
2-111111(any number of ones)-0 (i.e. high-mid-low) for a fusion or 0-1111...-2
(i.e. low-mid-high) for a fission. If there are multiple possible time periods
detected within the window, we choose the one where the start time is closest to <code>tidx</code>. (See also
subtlety 1 below).</p>
<p><em>How are the before and after times identified?</em></p>
<p>The before time is defined as the time point <code>tidx - time_window</code> (default
<code>time_window = 300</code> time steps), unless the two groups are not sufficiently together (for
a fission) or apart (for a fusion) at that time. If the latter, the <code>before_time</code>
is identified as the point just before the two subgroups cross a threshold <code>thresh_m</code> midway
between the upper and lower thresholds used to define the start and end times
(i.e. usually at <code>(thresh_l + thresh_h) / 2</code>, though if the upper or lower
thresholds get modified due to <em>subtlety 1</em> below, this will also modify <code>thresh_m</code>
accordingly).</p>
<p>The logic here is that, for a fusion we are looking for what the full group (combination of the
two eventual subgroups) was doing before they began to split. However, we do not
want this point to fall during a prior fusion event, so we require the centroids
of the two subgroups to be less than <code>(thresh_l + thresh_h) / 2</code> distance apart.
The after time is defined in an analogous way, but using the time period after the
event. It is usually set to <code>tidx + time_window</code>, unless the subgroups come back too
close together (for a fission) or go too far apart (for a fusion). Again, we use
the time just prior to crossing the midway point between the two thresholds as
the <code>after_time</code>, if this threshold is crossed before <code>time_window</code> seconds has elapsed.</p>
<p><em>How are the displacements defined?</em></p>
<p>We compute the displacement of the centroid of each subgroup (group A and group B)
as well as the displacement of the centroid of the combined group (group AB) during
each of the time windows: before (<code>before_time:start_time</code>), during (<code>start_time:end_time</code>)
and after (<code>end_time:after_time</code>).</p>
<p><em>How are the angles defined?</em></p>
<p>We define 3 relevant angles relevant to a fission event (might define more later
for merge events):
<code>split_angle</code>: this is the angle at which the two groups split. It is defined as
the angle traced out by the points <code>p_A(end_time)</code>, <code>p_AB(start_time)</code>, and <code>p_B(end_time)</code>
where <code>p_A(t)</code> is the position of subgroup A's centroid at time <code>t</code> and likewise
for subgroup B and the combined group.
<code>turn_angle_A</code>: the turning angle of subgroup A. This is defined as the angle
formed by the points <code>p_AB(before_time)</code>, <code>p_AB(start_time)</code>, and <code>p_A(end_time)</code>
turn_angle_B: likewise for subgroup B
Note that all angles use the point <code>p_AB(start_time)</code> as their central point</p>
<p><em>How are departure time difference and departure angular difference calculated?</em></p>
<p>To calculate the departure time difference and angular difference, we start by computing
the centroid of the full group at the event <em>start time</em> - call this the <em>group start position</em>.
We then determine, for each individual in each subgroup, a <em>departure time</em> that is defined
as the first time after <em>start time</em> when that individual crossed a threshold distance (<code>depart_or_arrive_radius</code>)
from the <em>start position</em>. We then compute the <em>departure heading</em> for each individual as the
vector pointing from the <em>group start position</em> to the position of the individual at its <em>departure time</em>.</p>
<p>Once we have computed <em>departure times</em> and <em>departure headings</em> for each individual, we compute
an aggregated metric of the disagreement in times and headings for the entire event. For departure time, we
calculate the <em>time disagreement</em> as the absolute difference between the mean <code>departure_time</code> of each subgroup.
Similarly, for departure heading, we calculate the <em>directional disagreement</em> as the angle between
the (vector) mean heading of each subgroup. The angle between vectors is defined between
0 and pi radians. The time difference is defined in seconds.</p>
<p>We can do the equivalent calculations for fusion events. Here, we define the <em>group end position</em>
as the centroid of the combined group at the <code>end_time</code>, and use this position as the reference point
for all the other calculations. Looking backward in time, we find the <em>arrival time</em> for each individual,
defined as the latest time before the <em>end time</em> where that individual remained outside a threshold
distance of <code>depart_or_arrive_radius</code>. The headings and time differences are then computed as above, and the
differences between times and angles as well.</p>
<p>To avoid having different column names for all of the above variables in the code, we create the columns:
<code>group_start_or_end_position</code> which is defined as the <em>group start position</em> for a fission and the <em>group end position</em> for a fusion,
<code>depart_or_arrive_times</code> which is a list of <em>departure times</em> (in the case of fissions) or <em>arrival times</em> (in the case of fusions),
<code>depart_or_arrive_headings</code> which is a lsit of <em>departure headings</em> (in the case of fissions) or <em>arrival headings</em> (in the case of fusions),
<code>depart_or_arrive_time_diff</code> which is a single number representing the <em>time disagreement</em> of departure (for fissions) or arrival (for fusions) times,
<code>depart_or_arrive_heading_diff</code> which is a single number representing the <em>directional disagreement</em> of departure (for fissions) or arrival (for fusions) headings.</p>
<p><em>SUBTLETIES</em>:</p>
<p><em>Subtlety 1</em>: Sometimes, due to the multi-scale nature of these events and the
fact that we are approximating subgroup locations with centroids, the dyadic
distance does not go below the lower threshold <code>thresh_l</code> and/or above the upper
threshold <code>thresh_h</code>. In this case, we still try to identify the <code>start_time</code> and
end_time, but modify the thresholds as follows:</p>
<p>First, let's define the period between <code>tidx - max_time</code> and <code>tidx</code> as the <em>prior period</em>,
the period between <code>tidx</code>  and <code>tidx + max_time</code> as the <em>subsequent period</em>, and the
period between <code>(tidx - max_time/2)</code> and <code>(tidx + max_time/2)</code> as the <em>middle period</em>.</p>
<p>For a fission, if the dyadic distance does not go above <code>thresh_h</code> in the <em>subsequent period</em>,
then we instead replace <code>thresh_h</code> with the maximum - .001 of the dyadic
distance during that time period. Second, if the dyadic distance during the <em>middle period</em>
does not drop below <code>thresh_l</code>, then we instead move <code>thresh_l</code> to the minimum + .001
of the dyadic distance during the <em>middle period</em>.</p>
<p>For a fusion, everything is reversed. If the dyadic distance does not go
above <code>thresh_h</code> during the <em>prior period</em>, we replace <code>thresh_h</code> with the maximum - .001
of the dyadic distance during the <em>subsequent period</em>. And if the dyadic distance does
not go below <code>thresh_l</code> during the <em>middle period</em>, we replace <code>thresh_l</code> with the minimum + .001
of the dyadic distance during the <em>middle period</em>.</p>
<p>In very rare cases, due to these rules the upper bound may get changed to
something below the original <code>thresh_l</code>, or the lower bound may get changed to
something above the original <code>thresh_h</code>. In that case, we revert to the original thresholds.</p>
<p><em>Subtlety 2</em>: NA handling. NAs are handled in a couple of different ways:</p>
<p>For finding the <code>start_time</code> and <code>end_time</code>, NAs are essentially ignored, and cannot
be part of the sequence from <code>start_time:end_time</code> (at least not in terms of the)
dyadic distance... individuals can drop out and they will just be excluded from
the centroid calculation.</p>
<p>If no start and end times are found, nothing else is computed (all output values are
filled in with <code>NA</code>s or <code>NULL</code> for matrices).</p>
<p>For finding the <code>before_time</code> and <code>after_time</code>, if an <code>NA</code> is hit in the forward or
backward direction, the <code>before_time</code> (or respectively, the <code>after_time</code>) is marked
as <code>NA</code>. Metrics involving that time point can then not be computed and are also set to
<code>NA</code>.</p>
<p>If the <code>start_time</code> and <code>end_time</code> are in different data chunks (as specified by <code>breaks</code>), then both are given <code>NA</code>.</p>
<p>If the <code>before_time</code> and <code>start_time</code>, or <code>after_time</code> and <code>end_time</code>, are in different data chunks (as specified by <code>breaks</code>), then
both are given NA.</p>
<p>If the <code>before_time</code> or <code>after_time</code> are <code>NA</code>, then other metrics stemming from those times get <code>NA</code></p>
    </div>
    <div class="section level2">
    <h2 id="author">Author<a class="anchor" aria-label="anchor" href="#author"></a></h2>
    <p>Ariana Strandburg-Peshkin (primary author)</p>
<p>NOT YET CODE REVIEWED</p>
    </div>

  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Ariana Strandburg-Peshkin.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer></div>





  </body></html>

